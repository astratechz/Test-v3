<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" 
      content="width=device-width, initial-scale=1.0, 
               maximum-scale=1.0, user-scalable=no">
<title>Live Player</title>

<!-- Shaka Player -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.7/shaka-player.compiled.js"></script>

<style>
    html, body {
        margin: 0;
        padding: 0;
        background: black;
        height: 100%;
        overflow: hidden;
    }

    video {
        width: 100vw;
        height: 100vh;
        background: black;
        object-fit: cover;
    }
</style>

</head>
<body>

<video id="video" autoplay controls muted playsinline></video>

<script>
/* ------------------ SETTINGS ------------------ */
const API_URL = "https://app.swaxnet.xyz/api/mpd-url";
const API_KEY = "Bearer 51b969b5ddee963de6c75686eb75adfd5709f31fd04335ee0a2654498868";

// Change this to whichever channel you want to load
const CHANNEL_ID = "YOUR_CHANNEL_ID_HERE";

/* ------------------ AUTO FULLSCREEN ------------------ */
function enterFullscreen() {
    const video = document.getElementById("video");
    if (video.requestFullscreen) video.requestFullscreen();
    if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("landscape").catch(() => {});
    }
}

document.addEventListener("click", enterFullscreen);
document.addEventListener("touchstart", enterFullscreen);

/* ------------------ FETCH STREAM ------------------ */
async function fetchMPD() {
    try {
        const response = await fetch(API_URL, {
            method: "POST",
            headers: {
                "Authorization": API_KEY,
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ channel_id: CHANNEL_ID })
        });

        const data = await response.json();

        if (!data || !data.mpd_url) {
            throw new Error("Invalid API response");
        }

        return data.mpd_url;

    } catch (err) {
        console.error("API Error:", err);
        alert("Error loading stream");
        return null;
    }
}

/* ------------------ INIT SHAKA ------------------ */
async function initPlayer() {
    if (!shaka.Player.isBrowserSupported()) {
        alert("Browser not supported");
        return;
    }

    const video = document.getElementById("video");
    const player = new shaka.Player(video);

    try {
        const mpdUrl = await fetchMPD();
        if (!mpdUrl) return;

        await player.load(mpdUrl);
        console.log("Stream Loaded:", mpdUrl);

    } catch (err) {
        console.error("Shaka Error:", err);
        alert("Unable to play stream");
    }
}

/* ------------------ AUTOSTART ------------------ */
document.addEventListener("DOMContentLoaded", initPlayer);

/* ------------------ AUTO ROTATE ------------------ */
window.addEventListener("orientationchange", () => {
    if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock("landscape").catch(() => {});
    }
});

/* Force landscape on load */
if (screen.orientation && screen.orientation.lock) {
    screen.orientation.lock("landscape").catch(() => {});
}
</script>

</body>
</html>
